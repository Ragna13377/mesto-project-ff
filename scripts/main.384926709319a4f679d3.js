!function(){"use strict";var t="https://nomoreparties.co/v1/wff-cohort-1",e="9c3c5c27-37ba-4290-8f1a-07fbcc8161b5",r=function(t){return console.log(t)},n=function(r){return fetch(t+r,{headers:{authorization:e}}).then(i)},o=function(r,n){return fetch(t+r,{method:arguments.length>2&&void 0!==arguments[2]?arguments[2]:"POST",headers:{authorization:e,"Content-Type":"application/json"},body:JSON.stringify(n)}).then(i)},i=function(t){return t.ok?t.json().then((function(e){return e.url=t.url,Promise.resolve(e)})):Promise.reject(t)},a=function(t,e){return o(t,e,arguments.length>2&&void 0!==arguments[2]&&arguments[2]?"PATCH":"PUT")},u=function(t){return o(t,{},"DELETE")},c=document.querySelector("#card-template").content,l=function(t){return t.classList.add("card__like-button_is-active")},s=function(t){var e=t.target,n=e.closest(".card__like-container").querySelector(".card__like-count"),o=e.closest(".card").dataset.id;e.classList.contains("card__like-button_is-active")?u("/cards/likes/"+o).then((function(t){e.classList.remove("card__like-button_is-active"),n.textContent=t.likes.length})).catch(r):a("/cards/likes/"+o).then((function(t){l(e),n.textContent=t.likes.length})).catch(r)},p=function(t,e,r){r.classList.remove(t.inputErrorClass);var n=e.querySelector("#".concat(r.getAttribute("name"),"-input-error"));n.classList.remove(t.errorClass),n.textContent=""},d=function(t,e,r){var n=e.querySelector(r.submitButtonSelector);!function(t){return t.some((function(t){return!t.validity.valid}))}(t)?(n.classList.remove(r.inactiveButtonClass),n.removeAttribute("disabled")):(n.classList.add(r.inactiveButtonClass),n.setAttribute("disabled",!0))},f=function(t){var e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"Сохранить",r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"Сохранение...";arguments.length>1&&void 0!==arguments[1]&&arguments[1]?(t.textContent=r,t.classList.add("popup__button_disabled"),t.setAttribute("disabled",!0)):(t.textContent=e,t.classList.remove("popup__button_disabled"),t.removeAttribute("disabled"))};function m(t,e){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"Сохранение...";e.preventDefault();var n=e.submitter,o=n.textContent;f(n,!0,r),t(e.currentTarget).then((function(t){t.reset()})).catch((function(t){return console.error("Ошибка: ".concat(t))})).finally((function(){f(n,!1,o)}))}var v=function(t){t.classList.add("popup_is-opened"),document.addEventListener("keydown",y)},_=function(t){t.classList.remove("popup_is-opened"),document.removeEventListener("keydown",y)},y=function(t){"Escape"===t.key&&_(document.querySelector(".popup_is-opened"))},b=function(t){t.target.classList.contains("popup")&&_(t.currentTarget)},g=function(t){t.target.classList.contains("popup__close")&&_(t.currentTarget)};function h(t){return h="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},h(t)}function S(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,(void 0,o=function(t,e){if("object"!==h(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!==h(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(n.key),"symbol"===h(o)?o:String(o)),n)}var o}function E(t,e,r){return e&&S(t.prototype,e),r&&S(t,r),Object.defineProperty(t,"prototype",{writable:!1}),t}var C=E((function t(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t);var n=document.querySelector(e);this.rootElement=n,r.length>0&&(this.trigger=document.querySelector(r)),this.form=n.querySelector(".popup__form"),this.button=n.querySelector(".popup__button")})),k={inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"},q=document.querySelector(".places__list"),L={title:document.querySelector(".profile__title"),description:document.querySelector(".profile__description"),image:document.querySelector(".profile__image")},A=new C(".popup_type_new-card",".profile__add-button"),w=new C(".popup_type_delete-card"),x=new C(".popup_type_edit-avatar",".profile__image-edit-button"),T=new C(".popup_type_edit",".profile__edit-button");T.title=T.rootElement.querySelector('input[name="name"]'),T.description=T.rootElement.querySelector('input[name="description"]');var j={rootElement:document.querySelector(".popup_type_image")};function P(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}j.image=j.rootElement.querySelector(".popup__image"),j.caption=j.rootElement.querySelector(".popup__caption");var I="",O=function(t,e){j.image.src=t,j.caption.textContent=e,v(j.rootElement)},B=function(t){w.form.setAttribute("data-id",t.target.closest(".card").dataset.id),v(w.rootElement)};function D(t){t.currentUserId=I;var e=function(t,e,r,n){var o=c.querySelector(".card").cloneNode(!0);o.setAttribute("data-id",t._id);var i=o.querySelector(".card__image"),a=o.querySelector(".card__like-button");i.src=t.link,i.alt=t.name,o.querySelector(".card__title").textContent=t.name,o.querySelector(".card__like-count").textContent=t.likes.length;var u=o.querySelector(".card__delete-button");return t.currentUserId===t.owner._id?u.addEventListener("click",r):u.remove(),t.likes.some((function(e){return e._id===t.currentUserId}))&&l(a),a.addEventListener("click",n),i.addEventListener("click",(function(){return e(t.link,t.name)})),o}(t,O,B,s);q.prepend(e)}var U,M=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){};t.trigger.addEventListener("click",(function(){var r,n,o;t.form.reset(),e(),r=t.form,n=k,(o=Array.from(r.querySelectorAll(n.inputSelector))).forEach((function(t){return p(n,r,t)})),d(o,r,n),v(t.rootElement)}))};M(A),M(T,(function(){T.title.value=L.title.textContent,T.description.value=L.description.textContent})),M(x),A.form.addEventListener("submit",(function(t){var e=new FormData(t.currentTarget),r={name:e.get("place-name"),link:e.get("link")};m((function(t){return("/cards",e=r,o("/cards",e)).then((function(e){return D(e),_(t.closest(".popup")),t}));var e}),t)})),T.form.addEventListener("submit",(function(t){var e=new FormData(t.currentTarget),r={name:e.get("name"),about:e.get("description")};m((function(t){return a("/users/me",r,!0).then((function(e){return L.title.textContent=e.name,L.description.textContent=e.about,_(t.closest(".popup")),t}))}),t)})),x.form.addEventListener("submit",(function(t){var e={avatar:new FormData(t.currentTarget).get("avatar")};m((function(t){return a("/users/me/avatar",e,!0).then((function(e){return L.image.style.backgroundImage='url("'.concat(e.avatar,'"'),_(t.closest(".popup")),t}))}),t)})),w.form.addEventListener("submit",(function(t){m((function(e){return u("/cards/"+t.currentTarget.dataset.id).then((function(t){var r;r=t.url.split("/").at(-1),document.querySelector('[data-id="'+r+'"]').remove(),_(e.closest(".popup"))}))}),t)})),Array.from(document.querySelectorAll(".popup")).forEach((function(t){t.addEventListener("click",b),t.addEventListener("click",g)})),U={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"},Array.from(document.querySelectorAll(U.formSelector)).forEach((function(t){!function(t,e){var r=Array.from(t.querySelectorAll(e.inputSelector));r.forEach((function(n){n.addEventListener("input",(function(){!function(t,e,r){e.validity.valid?p(r,t,e):function(t,e,r,n){r.classList.add(t.inputErrorClass);var o=e.querySelector("#".concat(r.getAttribute("name"),"-input-error"));o.classList.add(t.errorClass),o.textContent=n}(r,t,e,e.validity.patternMismatch?e.dataset.errorMessage:e.validationMessage)}(t,n,e),d(r,t,e)}))}))}(t,U)})),Promise.all([n("/users/me"),n("/cards")]).then((function(t){var e,r,n=(r=2,function(t){if(Array.isArray(t))return t}(e=t)||function(t,e){var r=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=r){var n,o,i,a,u=[],c=!0,l=!1;try{if(i=(r=r.call(t)).next,0===e){if(Object(r)!==r)return;c=!1}else for(;!(c=(n=i.call(r)).done)&&(u.push(n.value),u.length!==e);c=!0);}catch(t){l=!0,o=t}finally{try{if(!c&&null!=r.return&&(a=r.return(),Object(a)!==a))return}finally{if(l)throw o}}return u}}(e,r)||function(t,e){if(t){if("string"==typeof t)return P(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?P(t,e):void 0}}(e,r)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),o=n[0],i=n[1];L.title.textContent=o.name,L.description.textContent=o.about,L.image.style.backgroundImage='url("'.concat(o.avatar,'"'),L.image.src=o.avatar,I=o._id,i.forEach((function(t){return D(t)}))})).catch(r)}();