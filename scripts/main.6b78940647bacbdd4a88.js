!function(){"use strict";var t="https://nomoreparties.co/v1/wff-cohort-1",e="9c3c5c27-37ba-4290-8f1a-07fbcc8161b5",r=function(t){return console.log(t)},n=function(r){return fetch(t+r,{headers:{authorization:e}}).then(i)},o=function(r,n){return fetch(t+r,{method:arguments.length>2&&void 0!==arguments[2]?arguments[2]:"POST",headers:{authorization:e,"Content-Type":"application/json"},body:JSON.stringify(n)}).then(i)},i=function(t){return t.ok?t.json().then((function(t){return Promise.resolve(t)})):Promise.reject(t)},a=function(t,e){return o(t,e,arguments.length>2&&void 0!==arguments[2]&&arguments[2]?"PATCH":"PUT")},c=function(t){return o(t,{},"DELETE")},u=document.querySelector("#card-template").content,l=function(t){return t.classList.add("card__like-button_is-active")},s=function(t){var e=t.target,n=e.closest(".card__like-container").querySelector(".card__like-count"),o=e.closest(".card").dataset.id;e.classList.contains("card__like-button_is-active")?c("/cards/likes/"+o).then((function(t){e.classList.remove("card__like-button_is-active"),n.textContent=t.likes.length})).catch(r):a("/cards/likes/"+o).then((function(t){l(e),n.textContent=t.likes.length})).catch(r)},p=function(t,e,r){r.classList.remove(t.inputErrorClass);var n=e.querySelector("#".concat(r.getAttribute("name"),"-input-error"));n.classList.remove(t.errorClass),n.textContent=""},d=function(t,e,r){var n=e.querySelector(r.submitButtonSelector);!function(t){return t.some((function(t){return!t.validity.valid}))}(t)?(n.classList.remove(r.inactiveButtonClass),n.removeAttribute("disabled")):(n.classList.add(r.inactiveButtonClass),n.setAttribute("disabled",!0))},f=function(t){t.classList.add("popup_is-opened"),document.addEventListener("keydown",v)},m=function(t){t.classList.remove("popup_is-opened"),document.removeEventListener("keydown",v)},v=function(t){"Escape"===t.key&&m(document.querySelector(".popup_is-opened"))},_=function(t){t.target.classList.contains("popup")&&m(t.currentTarget)},y=function(t){t.target.classList.contains("popup__close")&&m(t.currentTarget)};function b(t){return b="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},b(t)}function g(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,(void 0,o=function(t,e){if("object"!==b(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!==b(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(n.key),"symbol"===b(o)?o:String(o)),n)}var o}function h(t,e,r){return e&&g(t.prototype,e),r&&g(t,r),Object.defineProperty(t,"prototype",{writable:!1}),t}var S=h((function t(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t);var n=document.querySelector(e);this.rootElement=n,r.length>0&&(this.trigger=document.querySelector(r)),this.form=n.querySelector(".popup__form"),this.button=n.querySelector(".popup__button")})),E={inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"},C=document.querySelector(".places__list"),k={title:document.querySelector(".profile__title"),description:document.querySelector(".profile__description"),image:document.querySelector(".profile__image")},q=new S(".popup_type_new-card",".profile__add-button"),L=new S(".popup_type_delete-card"),A=new S(".popup_type_edit-avatar",".profile__image-edit-button"),w=new S(".popup_type_edit",".profile__edit-button");w.title=w.rootElement.querySelector('input[name="name"]'),w.description=w.rootElement.querySelector('input[name="description"]');var x={rootElement:document.querySelector(".popup_type_image")};x.image=x.rootElement.querySelector(".popup__image"),x.caption=x.rootElement.querySelector(".popup__caption");var T=function(t){var e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"Сохранить",r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"Сохранение...";arguments.length>1&&void 0!==arguments[1]&&arguments[1]?(t.textContent=r,t.setAttribute("disabled",!0)):(t.textContent=e,t.removeAttribute("disabled"))};function j(t,e){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"Сохранение...";e.preventDefault();var n=e.submitter,o=n.textContent;T(n,!0,"",r),t(e.currentTarget).then((function(t){t.reset(),m(t.closest(".popup"))})).catch((function(t){return console.error("Ошибка: ".concat(t))})).finally((function(){T(n,!1,o)}))}function P(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){};t.trigger.addEventListener("click",(function(){var r,n,o;t.form.reset(),e(),r=t.form,n=E,(o=Array.from(r.querySelectorAll(n.inputSelector))).forEach((function(t){return p(n,r,t)})),d(o,r,n),f(t.rootElement)}))}function I(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}var O,B="",D=function(t,e){x.image.src=t,x.image.alt=e,x.caption.textContent=e,f(x.rootElement)},U=function(t){L.form.setAttribute("data-id",t.target.closest(".card").dataset.id),f(L.rootElement)};function M(t){t.currentUserId=B;var e=function(t,e,r,n){var o=u.querySelector(".card").cloneNode(!0);o.setAttribute("data-id",t._id);var i=o.querySelector(".card__image"),a=o.querySelector(".card__like-button");i.src=t.link,i.alt=t.name,o.querySelector(".card__title").textContent=t.name,o.querySelector(".card__like-count").textContent=t.likes.length;var c=o.querySelector(".card__delete-button");return t.currentUserId===t.owner._id?c.addEventListener("click",r):c.remove(),t.likes.some((function(e){return e._id===t.currentUserId}))&&l(a),a.addEventListener("click",n),i.addEventListener("click",(function(){return e(t.link,t.name)})),o}(t,D,U,s);C.prepend(e)}P(q),P(w,(function(){w.title.value=k.title.textContent,w.description.value=k.description.textContent})),P(A),q.form.addEventListener("submit",(function(t){var e=new FormData(t.currentTarget),r={name:e.get("place-name"),link:e.get("link")};j((function(t){return("/cards",e=r,o("/cards",e)).then((function(e){return M(e),t}));var e}),t)})),w.form.addEventListener("submit",(function(t){var e=new FormData(t.currentTarget),r={name:e.get("name"),about:e.get("description")};j((function(t){return a("/users/me",r,!0).then((function(e){return k.title.textContent=e.name,k.description.textContent=e.about,t}))}),t)})),A.form.addEventListener("submit",(function(t){var e={avatar:new FormData(t.currentTarget).get("avatar")};j((function(t){return a("/users/me/avatar",e,!0).then((function(e){return k.image.style.backgroundImage='url("'.concat(e.avatar,'"'),t}))}),t)})),L.form.addEventListener("submit",(function(t){j((function(e){return c("/cards/"+t.currentTarget.dataset.id).then((function(){var t;return t=e.dataset.id,document.querySelector('[data-id="'+t+'"]').remove(),e}))}),t)})),Array.from(document.querySelectorAll(".popup")).forEach((function(t){t.addEventListener("click",_),t.addEventListener("click",y)})),O={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"},Array.from(document.querySelectorAll(O.formSelector)).forEach((function(t){!function(t,e){var r=Array.from(t.querySelectorAll(e.inputSelector));r.forEach((function(n){n.addEventListener("input",(function(){!function(t,e,r){e.validity.valid?p(r,t,e):function(t,e,r,n){r.classList.add(t.inputErrorClass);var o=e.querySelector("#".concat(r.getAttribute("name"),"-input-error"));o.classList.add(t.errorClass),o.textContent=n}(r,t,e,e.validity.patternMismatch?e.dataset.errorMessage:e.validationMessage)}(t,n,e),d(r,t,e)}))}))}(t,O)})),("/users/me","/cards",Promise.all([n("/users/me"),n("/cards")])).then((function(t){var e,r,n=(r=2,function(t){if(Array.isArray(t))return t}(e=t)||function(t,e){var r=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=r){var n,o,i,a,c=[],u=!0,l=!1;try{if(i=(r=r.call(t)).next,0===e){if(Object(r)!==r)return;u=!1}else for(;!(u=(n=i.call(r)).done)&&(c.push(n.value),c.length!==e);u=!0);}catch(t){l=!0,o=t}finally{try{if(!u&&null!=r.return&&(a=r.return(),Object(a)!==a))return}finally{if(l)throw o}}return c}}(e,r)||function(t,e){if(t){if("string"==typeof t)return I(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?I(t,e):void 0}}(e,r)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),o=n[0],i=n[1];k.title.textContent=o.name,k.description.textContent=o.about,k.image.style.backgroundImage='url("'.concat(o.avatar,'"'),k.image.src=o.avatar,B=o._id,i.forEach((function(t){return M(t)}))})).catch(r)}();