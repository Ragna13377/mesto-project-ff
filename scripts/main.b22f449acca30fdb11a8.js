!function(){"use strict";var t="https://nomoreparties.co/v1/wff-cohort-1",e="9c3c5c27-37ba-4290-8f1a-07fbcc8161b5",r=function(t){return console.log(t)},n=function(r){return fetch(t+r,{headers:{authorization:e}}).then(i)},o=function(r,n){return fetch(t+r,{method:arguments.length>2&&void 0!==arguments[2]?arguments[2]:"POST",headers:{authorization:e,"Content-Type":"application/json"},body:JSON.stringify(n)}).then(i)},i=function(t){return t.ok?t.json().then((function(e){return e.url=t.url,Promise.resolve(e)})):Promise.reject(t)},a=function(t,e){return o(t,e,arguments.length>2&&void 0!==arguments[2]&&arguments[2]?"PATCH":"PUT")},c=function(t){return o(t,{},"DELETE")},u=document.querySelector("#card-template").content,l=function(t){return t.classList.add("card__like-button_is-active")},s=function(t){var e=t.target,n=e.closest(".card__like-container").querySelector(".card__like-count"),o=e.closest(".card").dataset.id;e.classList.contains("card__like-button_is-active")?(e.classList.remove("card__like-button_is-active"),c("/cards/likes/"+o).then((function(t){return n.textContent=t.likes.length})).catch(r)):(l(e),a("/cards/likes/"+o).then((function(t){return n.textContent=t.likes.length})).catch(r))},p=function(t,e,r){r.classList.remove(t.inputErrorClass);var n=e.querySelector("#".concat(r.getAttribute("name"),"-input-error"));n.classList.remove(t.errorClass),n.textContent=""},d=function(t,e,r){var n=e.querySelector(r.submitButtonSelector);!function(t){return t.some((function(t){return!t.validity.valid}))}(t)?n.classList.remove(r.inactiveButtonClass):n.classList.add(r.inactiveButtonClass)},f=function(t,e){var r=Array.from(t.querySelectorAll(e.inputSelector));r.forEach((function(r){return p(e,t,r)})),d(r,t,e)},m=function(t){t.classList.add("popup_is-opened"),document.addEventListener("keydown",v)},_=function(t){t.classList.remove("popup_is-opened"),document.removeEventListener("keydown",v)},v=function(t){"Escape"===t.key&&_(document.querySelector(".popup_is-opened"))},y=function(t){t.target.classList.contains("popup")&&_(t.currentTarget)},b=function(t){t.target.classList.contains("popup__close")&&_(t.currentTarget)};function g(t){return g="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},g(t)}function h(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function S(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,(void 0,o=function(t,e){if("object"!==g(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!==g(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(n.key),"symbol"===g(o)?o:String(o)),n)}var o}function E(t,e,r){return e&&S(t.prototype,e),r&&S(t,r),Object.defineProperty(t,"prototype",{writable:!1}),t}var k="",q={inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"},C=document.querySelector(".places__list"),L={title:document.querySelector(".profile__title"),description:document.querySelector(".profile__description"),image:document.querySelector(".profile__image")},w=E((function t(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t);var n=document.querySelector(e);this.rootElement=n,r.length>0&&(this.trigger=document.querySelector(r)),this.form=n.querySelector(".popup__form"),this.button=n.querySelector(".popup__button")})),A=new w(".popup_type_new-card",".profile__add-button"),x=new w(".popup_type_delete-card"),T=new w(".popup_type_edit-profile",".profile__image-edit-button"),j=new w(".popup_type_edit",".profile__edit-button");j.title=j.rootElement.querySelector('input[name="name"]'),j.description=j.rootElement.querySelector('input[name="description"]');var P={rootElement:document.querySelector(".popup_type_image")};P.image=P.rootElement.querySelector(".popup__image"),P.caption=P.rootElement.querySelector(".popup__caption");var D,I=function(t){arguments.length>1&&void 0!==arguments[1]&&arguments[1]?(t.button.textContent="Сохранение...",t.button.classList.add("popup__button_disabled")):(t.button.textContent="Сохранить",t.button.classList.remove("popup__button_disabled"))},O=function(t,e){P.image.src=t,P.caption.textContent=e,m(P.rootElement)},B=function(t){x.form.setAttribute("data-id",t.target.closest(".card").dataset.id),m(x.rootElement)};function U(t){t.currentUserId=k;var e=function(t,e,r){var n=u.querySelector(".card").cloneNode(!0);n.setAttribute("data-id",t._id),n.querySelector(".card__image").src=t.link,n.querySelector(".card__title").textContent=t.name,n.querySelector(".card__like-count").textContent=t.likes.length;var o=n.querySelector(".card__delete-button");return t.currentUserId===t.owner._id?o.addEventListener("click",r):o.remove(),t.likes.some((function(e){return e._id===t.currentUserId}))&&l(n.querySelector(".card__like-button")),n.querySelector(".card__like-button").addEventListener("click",s),n.querySelector(".card__image").addEventListener("click",(function(){return e(t.link,t.name)})),n}(t,O,B);C.prepend(e)}A.trigger.addEventListener("click",(function(){A.form.reset(),f(A.form,q),m(A.rootElement)})),j.trigger.addEventListener("click",(function(){j.title.value=L.title.textContent,j.description.value=L.description.textContent,f(j.form,q),m(j.rootElement)})),T.trigger.addEventListener("click",(function(){T.form.reset(),f(T.form,q),m(T.rootElement)})),A.form.addEventListener("submit",(function(t){t.preventDefault();var e,n=new FormData(t.currentTarget);I(A,!0),("/cards",e={name:n.get("place-name"),link:n.get("link")},o("/cards",e)).then((function(t){return U(t)})).catch(r).finally((function(){_(A.rootElement),I(A)}))})),j.form.addEventListener("submit",(function(t){t.preventDefault();var e=new FormData(t.currentTarget),n={name:e.get("name"),about:e.get("description")};I(j,!0),a("/users/me",n,!0).then((function(t){L.title.textContent=t.name,L.description.textContent=t.about})).catch(r).finally((function(){_(j.rootElement),I(j)}))})),T.form.addEventListener("submit",(function(t){t.preventDefault();var e={avatar:new FormData(t.currentTarget).get("avatar")};I(T,!0),a("/users/me/avatar",e,!0).then((function(t){return L.image.style.backgroundImage='url("'.concat(t.avatar,'"')})).catch(r).finally((function(){_(T.rootElement),I(T)}))})),x.form.addEventListener("submit",(function(t){t.preventDefault(),I(x,!0),c("/cards/"+t.currentTarget.dataset.id).then((function(t){return e=t.url.split("/").at(-1),document.querySelector('[data-id="'+e+'"]').remove();var e})).catch(r).finally((function(){_(x.rootElement),I(x)}))})),Array.from(document.querySelectorAll(".popup")).forEach((function(t){t.addEventListener("click",y),t.addEventListener("click",b)})),D={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"},Array.from(document.querySelectorAll(D.formSelector)).forEach((function(t){!function(t,e){var r=Array.from(t.querySelectorAll(e.inputSelector));r.forEach((function(n){n.addEventListener("input",(function(){!function(t,e,r){e.validity.valid?p(r,t,e):function(t,e,r,n){r.classList.add(t.inputErrorClass);var o=e.querySelector("#".concat(r.getAttribute("name"),"-input-error"));o.classList.add(t.errorClass),o.textContent=n}(r,t,e,e.validity.patternMismatch?e.dataset.errorMessage:e.validationMessage)}(t,n,e),d(r,t,e)}))}))}(t,D)})),Promise.all([n("/users/me"),n("/cards")]).then((function(t){var e,r,n=(r=2,function(t){if(Array.isArray(t))return t}(e=t)||function(t,e){var r=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=r){var n,o,i,a,c=[],u=!0,l=!1;try{if(i=(r=r.call(t)).next,0===e){if(Object(r)!==r)return;u=!1}else for(;!(u=(n=i.call(r)).done)&&(c.push(n.value),c.length!==e);u=!0);}catch(t){l=!0,o=t}finally{try{if(!u&&null!=r.return&&(a=r.return(),Object(a)!==a))return}finally{if(l)throw o}}return c}}(e,r)||function(t,e){if(t){if("string"==typeof t)return h(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?h(t,e):void 0}}(e,r)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),o=n[0],i=n[1];L.title.textContent=o.name,L.description.textContent=o.about,L.image.style.backgroundImage='url("'.concat(o.avatar,'"'),L.image.src=o.avatar,i.forEach((function(t){k=o._id,U(t)}))})).catch(r)}();